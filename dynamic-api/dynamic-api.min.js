!function(e,n){"function"==typeof define&&define.amd?define(["jquery"],n):"object"==typeof exports?module.exports=n(require("jquery")):e.DynamicAPI=n(e.jQuery)}(this,function(e){function n(e,n){function t(){}return t.prototype=(e.superclass=n).prototype,(e.prototype=new t).constructor=e,"function"==typeof n.extended&&n.extended(e),e}function t(e,n){var t={}.hasOwnProperty;for(var r in n)t.call(n,r)&&(e[r]=n[r]);return e}/**
 * Dynamic API loader class
 *
 * @description Loads script by URL and waits for global variable
 * @module dynamic-api
 * @version 1.0.0
 * @author Viacheslav Lotsmanov
 * @license GNU/AGPLv3
 * @see {@link https://github.com/unclechu/js-useful-umd-modules/|GitHub}
 * @see {@link https://github.com/unclechu/js-useful-umd-modules/blob/master/AGPLv3-LICENSE|License}
 */
var r,l={}.toString;return r=function(){function r(e){var n,t,r,i;return n=null!=(t=e.interval)?t:500,r=null!=(t=e.async)?t:!0,function(e,n,t){if(l.call(t).slice(8,-1)!==e)throw new this.exceptions.IncorrectArgument({argName:n,argType:l.call(t).slice(8,-1),mustBe:e})}.call(this,"Number","interval",n),function(e,n,t){if(l.call(t).slice(8,-1)!==e)throw new this.exceptions.IncorrectArgument({argName:n,argType:l.call(t).slice(8,-1),mustBe:e})}.call(this,"Boolean","async",r),this._interval=n,this._async=r,i=function(){var e=this;return function(){return e.dynamicLoadApi.apply(e,arguments)}}.call(this,this),i["super"]=this,i}r.displayName="DynamicAPI";var i,a,u,o=r.prototype;return i=[],a=function(n,t){var l;if(l=null,e.each(n,function(e,n){return n.scriptPath===t?(l=n,!1):void 0}),null==l)throw new r.exceptions.ItemNotFound({scriptPath:t});return l},o.dynamicLoadApi=function(n,t,r){var o,s,c,m,p,h,d,g,y=this;if(function(e,n,t){return null==t?u(new this.exceptions.RequiredArgument({argName:n})):l.call(t).slice(8,-1)!==e?u(new this.exceptions.IncorrectArgument({argName:n,argType:l.call(t).slice(8,-1),mustBe:e})):void 0}.call(this,"Function","cb",r),function(e,n,t){return null==t?u(new this.exceptions.RequiredArgument({argName:n}),r):l.call(t).slice(8,-1)!==e?u(new this.exceptions.IncorrectArgument({argName:n,argType:l.call(t).slice(8,-1),mustBe:e}),r):t?void 0:u(new this.exceptions.RequiredArgument({argName:n}),r)}.call(this,"String","scriptPath",n),function(e,n,t){return null==t?u(new this.exceptions.RequiredArgument({argName:n}),r):l.call(t).slice(8,-1)!==e?u(new this.exceptions.IncorrectArgument({argName:n,argType:l.call(t).slice(8,-1),mustBe:e}),r):t?void 0:u(new this.exceptions.RequiredArgument({argName:n}),r)}.call(this,"String","globalVarName",t),o=!1,s=null,e.each(i,function(e,t){t.scriptPath===n&&(o=!0)}),!o){if(t in window)return u(new this.exceptions.GlobalNameAlreadyTaken({globalName:t}),r);for(c=0,p=(m=i).length;p>c;++c)if(s=m[c],s.varName===t)return u(new this.exceptions.GlobalNameAlreadyTaken({globalName:t}),r);i.push({scriptPath:n,loaded:!1,timerId:null,varName:t,cb:[]}),h=e("<script/>",{src:n}),this._async&&h.attr({async:"async"}),e("head").append(h)}try{s=a(i,n)}catch(f){return d=f,u(err,r)}return g=function(){return s.varName in window?(s.loaded=!0,s.timerId=null,null!=s.cb&&e.each(s.cb,function(n,t){setTimeout(e.proxy(t,null,null,window[s.varName]),0)}),void(s.cb=null)):void(s.timerId=setTimeout(g,y._interval))},s.loaded?setTimeout(e.proxy(r,null,null,window[s.varName]),0):(s.cb.push(r),void(s.timerId=setTimeout(g,0)))},u=function(n,t){if(null==t&&(t=null),null==t)throw n;setTimeout(e.proxy(t,null,n),0)},r.exceptions=r.prototype.exceptions={},r.exceptions.IncorrectArgument=function(e){function r(e){var n,t,r,l,i;n=null!=(t=e.message)?t:null,r=null!=(t=e.argName)?t:null,l=null!=(t=e.argType)?t:null,i=null!=(t=e.mustBe)?t:null,this.name="IncorrectArgument",this.message=null!=n?n:"Incorrect"+(null!=r?' "'+r+'"':"")+" argument type"+(null!=l?': "'+l+'"':"")+(null!=i?', must be a(n) "'+i+'"':"")+".",this.argName=r,this.argType=l,this.mustBe=i}n((t(r,e).displayName="IncorrectArgument",r),e).prototype;return r}(Error),r.exceptions.RequiredArgument=function(e){function r(e){var n,t,r;n=null!=(t=e.message)?t:null,r=null!=(t=e.argName)?t:null,this.name="RequiredArgument",this.message=null!=n?n:"Argument"+(null!=r?' "'+r+'"':"")+" is required.",this.argName=r}n((t(r,e).displayName="RequiredArgument",r),e).prototype;return r}(Error),r.exceptions.ItemNotFound=function(e){function r(e){var n,t,r;n=null!=(t=e.message)?t:null,r=null!=(t=e.scriptPath)?t:null,this.name="ItemNotFound",this.message=null!=n?n:"Cannot get item by script path"+(null!=r?': "'+r+'"':"")+".",this.scriptPath=r}n((t(r,e).displayName="ItemNotFound",r),e).prototype;return r}(Error),r.exceptions.GlobalNameAlreadyTaken=function(e){function r(e){var n,t,r;n=null!=(t=e.message)?t:null,r=null!=(t=e.globalName)?t:null,this.name="Timeout",this.message=null!=n?n:"Global name "+(null!=r?'"'+r+'" ':"")+"is already taken.",this.globalName=r}n((t(r,e).displayName="GlobalNameAlreadyTaken",r),e).prototype;return r}(Error),r}()});